# 进程和线程

## 什么是进程什么是线程

**进程**是指在系统中正在运行的一个应用程序；程序一旦运行就是进程，或者更专业化来说：进程是指程序执行时的一个实例。从内核的观点看，进程的目的就是担当分配系统资源（内存）的基本单位。

**线程**是进程之内独立执行的一个单元执行流，是系统分配处理器时间资源的基本单元。

**进程 - 资源分配的最小单位，线程 - 程序执行的最小单位**。

## 进程和线程的区别

### 内存分配

因为**进程拥有独立的堆栈空间和数据段**，所以每当启动一个新的进程必须分配给它独立的地址空间，建立众多的数据表来维护它的代码段、堆栈段和数据段，这对于多进程来说十分“奢侈”，系统开销比较大。

而线程不一样，**线程拥有独立的堆栈空间，但是共享数据段**，它们彼此之间使用相同的地址空间，共享大部分数据，比进程更节俭，开销比较小，切换速度也比进程快，效率高。

### 安全性和稳定性

由于进程之间独立的特点，使得进程安全性比较高，也因为进程有独立的地址空间，一个进程崩溃后，在保护模式下不会对其它进程产生影响，而线程只是一个进程中的不同执行路径。一个线程死掉就等于整个进程死掉。

### 通信机制

进程之间互不干扰，相互独立，进程的通信机制相对很复杂，譬如管道，信号，消息队列，共享内存，套接字等通信机制，而线程由于共享数据段所以通信机制很方便。

### CPU 使用效率

线程使得 CPU 系统更加有效，因为操作系统会保证当线程数不大于 CPU 数目时，不同的线程运行于不同的 CPU 上。

### 程序结构

当我们使用进程的时候，我们不自主的使用if else嵌套来判断pid，使得程序结构繁琐，但是当我们使用线程的时候，基本上可以甩掉它，当然程序内部执行功能单元需要使用的时候还是要使用，所以线程对程序结构的改善有很大帮助。

## 进程与线程的选择

进程与线程的选择取决以下几点：
1. 需要频繁创建销毁的优先使用线程；因为对进程来说创建和销毁一个进程代价是很大的。
2. 线程的切换速度快，所以在需要大量计算，切换频繁时用线程，还有耗时的操作使用线程可提高应用程序的响应
3. 因为对CPU系统的效率使用上线程更占优，所以可能要发展到多机分布的用进程，多核分布用线程
4. 并行操作时使用线程，如C/S架构的服务器端并发线程响应用户的请求
5. 需要更稳定安全时，适合选择进程；需要速度时，选择线程更好
